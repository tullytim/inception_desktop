<!--
MIT License

Copyright (c) 2025 Tim Tully

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Inception</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://api.inceptionlabs.ai; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.inceptionlabs.ai; img-src 'self' data: https://framerusercontent.com;">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism.min.css">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #181a20;
      color: #e6e6e6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    /* Light theme styles */
    body.light-theme {
      background: #f8fafc;
      color: #1e293b;
    }
    
    body.light-theme .sidebar {
      background: #ffffff;
      box-shadow: 2px 0 12px rgba(0,0,0,0.08);
    }
    
    body.light-theme .sidebar-header {
      border-bottom: 1px solid #e2e8f0;
    }
    
    body.light-theme .sidebar-logo {
      color: #1e293b;
    }
    
    body.light-theme .sidebar-item {
      color: #64748b;
    }
    
    body.light-theme .sidebar-item:hover {
      background: #f1f5f9;
      color: #059669;
    }
    
    body.light-theme .sidebar-item.active {
      background: #f1f5f9;
      color: #059669;
    }
    
    body.light-theme .hamburger-btn {
      background: #ffffff;
      color: #1e293b;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    body.light-theme .hamburger-btn:hover {
      background: #f1f5f9;
    }
    
    body.light-theme .sidebar-section-title {
      color: #64748b;
    }
    
    body.light-theme .recent-chat-item:hover {
      background: #f1f5f9;
      border-left-color: #059669;
    }
    
    body.light-theme .recent-chat-title {
      color: #1e293b;
    }
    
    body.light-theme .recent-chat-date {
      color: #64748b;
    }
    
    body.light-theme .chat-input-area {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      box-shadow: 0 12px 40px rgba(0,0,0,0.08), 0 6px 20px rgba(0,0,0,0.05), 0 2px 8px rgba(0,0,0,0.03);
    }
    
    body.light-theme .chat-input-area:hover {
      box-shadow: 0 16px 50px rgba(0,0,0,0.1), 0 8px 25px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
    }
    
    body.light-theme .chat-input-area input {
      background: #f8fafc;
      color: #1e293b;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
    }
    
    body.light-theme .chat-input-area input:focus {
      box-shadow: 0 2px 16px rgba(59,130,246,0.08);
      border: 1.5px solid #059669;
    }
    
    body.light-theme .bottom-buttons .model-select {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #64748b;
      box-shadow: 0 1px 3px rgba(0,0,0,0.02);
    }
    
    body.light-theme .bottom-buttons .model-select:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      color: #475569;
    }
    
    body.light-theme .bottom-buttons .model-select:focus {
      background: #f1f5f9;
      border-color: #94a3b8;
      color: #475569;
    }
    
    body.light-theme .bottom-buttons .model-select option {
      background: #f1f5f9;
      color: #475569;
    }
    
    body.light-theme .chat-input-area .bottom-btn {
      background: #f8fafc !important;
      color: #64748b !important;
      box-shadow: 0 1px 3px rgba(0,0,0,0.02);
    }
    
    body.light-theme .chat-input-area .bottom-btn:hover {
      background: #f1f5f9 !important;
      color: #475569 !important;
    }
    
    body.light-theme .modal {
      background: rgba(0,0,0,0.3);
    }
    
    body.light-theme .modal-content {
      background: #ffffff;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    body.light-theme .modal-header {
      border-bottom: 1px solid #e2e8f0;
    }
    
    body.light-theme .modal-title {
      color: #1e293b;
    }
    
    body.light-theme .modal-close {
      color: #64748b;
    }
    
    body.light-theme .modal-close:hover {
      background: #f1f5f9;
      color: #059669;
    }
    
    body.light-theme .modal-body {
      color: #1e293b;
    }
    
    body.light-theme .setting-label {
      color: #1e293b;
    }
    
    body.light-theme .setting-input {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #1e293b;
    }
    
    body.light-theme .setting-input:focus {
      border-color: #059669;
    }
    
    body.light-theme .setting-description {
      color: #64748b;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    
    button:hover {
      background: #005a9e;
    }
    
    #results {
      flex: 1;
      padding: 32px 0 160px 0;
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
      min-height: 0;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .chat-input-area {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 32px;
      background: #23262f;
      display: flex;
      flex-direction: column;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 12px 40px rgba(0,0,0,0.4), 0 6px 20px rgba(0,0,0,0.25), 0 2px 8px rgba(0,0,0,0.15);
      padding: 0;
      border-radius: 20px;
      max-width: 800px;
      width: calc(100% - 40px);
      border: 1px solid #374151;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .chat-input-area:hover {
      transform: translateX(-50%) translateY(-2px);
      box-shadow: 0 16px 50px rgba(0,0,0,0.5), 0 8px 25px rgba(0,0,0,0.3), 0 4px 12px rgba(0,0,0,0.2);
    }
    .chat-input-area-inner {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 18px 24px 8px 24px;
      border: none;
      background: none;
    }
    
    .chat-input-area input {
      flex: 1;
      max-width: 600px;
      background: #181a20;
      border: none;
      color: #e6e6e6;
      font-size: 1.1em;
      padding: 14px 18px;
      border-radius: 10px;
      outline: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: box-shadow 0.2s, border 0.2s;
    }
    
    .chat-input-area input:focus {
      box-shadow: 0 2px 16px rgba(59,130,246,0.13);
      border: 1.5px solid #6ee7b7;
    }
    
    .bottom-buttons .model-select {
      background: #2d3142;
      border: 1px solid #374151;
      color: #9ca3af;
      font-size: 0.8em;
      padding: 8px 10px;
      border-radius: 6px;
      outline: none;
      transition: background 0.2s, border 0.2s, color 0.2s;
      cursor: pointer;
      min-width: 120px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-right: 32px;
    }
    
    .bottom-buttons .model-select:hover {
      background: #374151;
      border-color: #4b5563;
      color: #d1d5db;
    }
    
    .bottom-buttons .model-select:focus {
      background: #374151;
      border-color: #6b7280;
      color: #d1d5db;
    }
    
    .bottom-buttons .model-select option {
      background: #374151;
      color: #d1d5db;
      font-size: 0.8em;
    }
    
    .chat-input-area button {
      background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 100%);
      color: #fff;
      border: none;
      padding: 0 24px;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(59,130,246,0.10);
    }
    
    .chat-input-area button:hover {
      background: linear-gradient(135deg, #3b82f6 0%, #6ee7b7 100%);
      box-shadow: 0 2px 16px rgba(59,130,246,0.13);
    }
    
    .chat-input-area svg {
      width: 22px;
      height: 22px;
      fill: #fff;
      pointer-events: none;
    }
    
    @media (max-width: 700px) {
      #results {
        padding: 16px 0 140px 0;
      }
      .chat-input-area {
        width: calc(100% - 20px);
        bottom: 20px;
        border-radius: 18px;
        box-shadow: 0 10px 35px rgba(0,0,0,0.4), 0 5px 18px rgba(0,0,0,0.25), 0 2px 8px rgba(0,0,0,0.15);
      }
      .chat-input-area:hover {
        transform: translateX(-50%) translateY(-1px);
        box-shadow: 0 12px 42px rgba(0,0,0,0.45), 0 6px 22px rgba(0,0,0,0.3), 0 3px 10px rgba(0,0,0,0.2);
      }
      .chat-input-area-inner {
        padding: 12px 16px 6px 16px;
      }
      .bottom-buttons {
        padding: 6px 16px 12px 16px;
      }
      .messages { padding: 0 10px; }
    }
    
    .sidebar {
      position: fixed;
      left: -280px;
      top: 0;
      width: 280px;
      height: 100vh;
      background: #23262f;
      box-shadow: 2px 0 12px rgba(0,0,0,0.15);
      transition: left 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    .sidebar.open {
      left: 0;
    }
    .sidebar-header {
      padding: 24px 20px 16px 20px;
      border-bottom: 1px solid #2d3142;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.4em;
      font-weight: 700;
      color: #fff;
    }
    .sidebar-logo img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }
    .sidebar-menu {
      flex: 1;
      padding: 20px 0;
    }
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: #b0b3c0;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 1em;
    }
    .sidebar-item:hover {
      background: #2d3142;
      color: #6ee7b7;
    }
    .sidebar-item.active {
      background: #2d3142;
      color: #6ee7b7;
    }
    .hamburger-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background: #23262f;
      border: none;
      color: #e6e6e6;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
      transition: background 0.2s;
    }
    .hamburger-btn:hover {
      background: #2d3142;
    }
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .sidebar-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    .main-content {
      transition: margin-left 0.3s ease;
    }
    .main-content.sidebar-open {
      margin-left: 280px;
    }
    @media (max-width: 768px) {
      .main-content.sidebar-open {
        margin-left: 0;
      }
    }
    .recent-chat-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.2s;
      border-left: 3px solid transparent;
    }
    .recent-chat-item:hover {
      background: #2d3142;
      border-left-color: #6ee7b7;
    }
    .recent-chat-title {
      color: #e6e6e6;
      font-size: 0.9em;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .recent-chat-date {
      color: #b0b3c0;
      font-size: 0.8em;
    }
    .recents-container {
      max-height: 300px;
      overflow-y: auto;
    }
    .sidebar-section-title {
      padding: 8px 20px 4px 20px;
      color: #b0b3c0;
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 16px;
    }
    
    .bottom-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 24px 18px 24px;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }
    
    .bottom-buttons-left {
      display: flex;
      gap: 12px;
    }

    .toggle-wrap {
      display: none;
      align-items: center;
      gap: 8px;
    }
    .toggle-label {
      font-size: 0.8em;
      color: #9ca3af;
      user-select: none;
    }
    body.light-theme .toggle-label {
      color: #64748b;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 36px;
      height: 20px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: #374151;
      border-radius: 20px;
      transition: background 0.2s;
    }
    .toggle-slider:before {
      content: '';
      position: absolute;
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background: #6b7280;
      border-radius: 50%;
      transition: transform 0.2s, background 0.2s;
    }
    .toggle-switch input:checked + .toggle-slider {
      background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 100%);
    }
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(16px);
      background: white;
    }
    
    .chat-input-area .bottom-btn {
      background: #2d3142 !important;
      border: none;
      color: #9ca3af !important;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      width: 36px;
      height: 36px;
    }
    
    .chat-input-area .bottom-btn:hover {
      background: #374151 !important;
      color: #d1d5db !important;
    }
    
    .bottom-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }
    
    /* Modal styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .modal.open {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: #23262f;
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal.open .modal-content {
      transform: scale(1);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid #2d3142;
    }
    
    .modal-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #e6e6e6;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: #b0b3c0;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }
    
    .modal-close:hover {
      background: #2d3142;
      color: #6ee7b7;
    }
    
    .modal-close svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }
    
    .modal-body {
      color: #e6e6e6;
    }
    
    .setting-item {
      margin-bottom: 20px;
    }
    
    .setting-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #e6e6e6;
    }
    
    .setting-input {
      width: 100%;
      background: #181a20;
      border: 1px solid #2d3142;
      color: #e6e6e6;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 1em;
      box-sizing: border-box;
    }
    
    .setting-input:focus {
      outline: none;
      border-color: #6ee7b7;
    }
    
    .setting-description {
      font-size: 0.9em;
      color: #b0b3c0;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <button class="hamburger-btn" id="hamburger-btn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
      <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <img src="images/inception.png" alt="Inception Logo" />
        Inception
      </div>
    </div>
    <div class="sidebar-menu">
      <button class="sidebar-item active" data-action="new-chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        New Chat
      </button>
      <button class="sidebar-item" data-action="recents">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 3h18v18H3V3zm16 16V5H5v14h14zM7 7h10v2H7V7zm0 4h10v2H7v-2zm0 4h7v2H7v-2z"/>
        </svg>
        Recents
      </button>
      <div class="sidebar-section-title">Recent Chats</div>
      <div class="recents-container" id="recents-list">
        <!-- Recent chats will be loaded here -->
      </div>
      <button class="sidebar-item" data-action="settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 8a4 4 0 100 8 4 4 0 000-8zM12 6a6 6 0 110 12 6 6 0 010-12z"/>
          <path d="M12 1l2.25 2.25L12 5.5 9.75 3.25 12 1zM19 12l2.25-2.25L23.5 12l-2.25 2.25L19 12zM12 23l-2.25-2.25L12 18.5l2.25 2.25L12 23zM5 12L2.75 9.75.5 12l2.25 2.25L5 12z"/>
        </svg>
        Settings
      </button>
    </div>
    <div style="padding: 12px 20px 20px 20px; color: #4b5563; font-size: 0.75em;" id="sidebar-version"></div>
  </div>
  
  <div class="main-content" id="main-content">
    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 32px;">
      <img src="images/inception.png" alt="Inception Logo" style="width:56px;height:56px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.10);margin-bottom:18px;" />
    </div>
    <div id="results"></div>
    <div class="chat-input-area">
      <form id="chat-form" class="chat-input-area-inner" autocomplete="off">
        <input type="text" id="chat-input" placeholder="Type your message..." autocomplete="off" />
        <button type="submit" aria-label="Send">
          <svg viewBox="0 0 24 24"><path d="M2 21l21-9-21-9v7l15 2-15 2z"/></svg>
        </button>
      </form>
      <div class="bottom-buttons">
        <div class="bottom-buttons-left">
          <button class="bottom-btn" id="clear-chat-btn" title="Clear Chat">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
          </button>
          <button class="bottom-btn" id="settings-btn" title="Settings">
            <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/></svg>
          </button>
        </div>
        <div class="toggle-wrap" id="reasoning-toggle-wrap">
          <span class="toggle-label">Instant Reasoning</span>
          <label class="toggle-switch" title="Enable reasoning_effort: instant">
            <input type="checkbox" id="reasoning-toggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <select id="model-select" class="model-select">
          <option value="mercury-coder">Mercury Coder</option>
          <option value="mercury">Mercury</option>
          <option value="mercury-2" selected>Mercury 2</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- API Key Prompt Modal -->
  <div class="modal" id="api-key-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">API Key Required</h2>
      </div>
      <div class="modal-body">
        <p style="margin: 0 0 16px 0; color: #b0b3c0; font-size: 0.95em;">
          Enter your Inception Labs API key to get started. It will be saved to
          <code style="background: #181a20; padding: 2px 6px; border-radius: 4px; font-size: 0.85em;">~/.inception</code>.
          Don't have one? <a href="https://platform.inceptionlabs.ai/dashboard/api-keys" target="_blank" style="color: #6ee7b7; text-decoration: none;">Get an API key →</a>
        </p>
        <div class="setting-item">
          <label class="setting-label" for="api-key-prompt-input">API Key</label>
          <input type="password" id="api-key-prompt-input" class="setting-input" placeholder="Enter your API key...">
        </div>
        <div style="display: flex; gap: 12px; margin-top: 8px;">
          <button id="api-key-prompt-skip" style="flex: 1; padding: 12px; background: #2d3142; color: #9ca3af; border: 1px solid #374151; border-radius: 8px; font-size: 1em; cursor: pointer;">Skip for now</button>
          <button id="api-key-prompt-save" style="flex: 2; padding: 12px; background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 100%); color: white; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 500;">Save API Key</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Settings</h2>
        <button class="modal-close" id="modal-close">
          <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="setting-item">
          <label class="setting-label" for="api-key-input">API Key</label>
          <input type="password" id="api-key-input" class="setting-input" placeholder="Enter your API key">
          <div class="setting-description">Your API key for Inception Labs AI</div>
        </div>
        <div class="setting-item">
          <label class="setting-label" for="model-setting">Default Model</label>
          <select id="model-setting" class="setting-input">
            <option value="mercury-coder-small">Mercury Coder Small</option>
            <option value="mercury-coder-large">Mercury Coder Large</option>
            <option value="mercury">Mercury</option>
            <option value="mercury-2" selected>Mercury 2</option>
          </select>
          <div class="setting-description">Choose your preferred AI model</div>
        </div>
        <div class="setting-item">
          <label class="setting-label" for="max-tokens-input">Max Tokens</label>
          <input type="number" id="max-tokens-input" class="setting-input" value="16384" min="1" max="16384">
          <div class="setting-description">Maximum number of tokens in response (1–16384)</div>
        </div>
        <div class="setting-item">
          <label class="setting-label" for="theme-setting">Theme</label>
          <select id="theme-setting" class="setting-input">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="auto">Auto</option>
          </select>
          <div class="setting-description">Choose your preferred theme</div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const entities = {
        '&amp;': '&',
        '&lt;': '<',
        '&gt;': '>',
        '&quot;': '"',
        '&#39;': "'",
        '&#x2F;': '/',
        '&#x60;': '`',
        '&#x3D;': '=',
        '&nbsp;': ' ',
        '&copy;': '©',
        '&reg;': '®',
        '&trade;': '™',
        '&euro;': '€',
        '&pound;': '£',
        '&yen;': '¥'
    };
    function decodeHTMLEntities(text) {
        // Handle numeric entities
        text = text.replace(/&#(\d+);/g, function(match, dec) {
            return String.fromCharCode(parseInt(dec, 10));
        });
        // Handle hex entities
        text = text.replace(/&#x([0-9a-f]+);/gi, function(match, hex) {
            return String.fromCharCode(parseInt(hex, 16));
        });
        // Handle any remaining entities
        return text.replace(/&[^;]+;/g, function(match) {
            return entities[match] || match;
        });
    }
    function setBodyClass(cl){document.getElementById("body").className = cl;}
    function inject(h, div_id){
        h = decodeHTMLEntities(h)
        document.getElementById(div_id).innerHTML += h;
        setTimeout(() => {
          document.getElementById(div_id).scrollTop = document.getElementById(div_id).scrollHeight;
        }, 0);
    }
    function renderMarkdown(html, cur_div_id){
        document.getElementById(cur_div_id).innerHTML = marked.parse(html);
        Prism.highlightAll();
    }
    marked.setOptions({
        highlight: function(code, lang) {
             if (Prism.languages[lang]) {
               return Prism.highlight(code, Prism.languages[lang], lang);
             } else {
               return code;
             }
        }
     });
     marked.use({html:false, gfm:true});
  </script>
  <script src="renderer.js"></script>
  <script>
    const MODEL_MAX_TOKENS = {
      'mercury': 16384,
      'mercury-2': 16384,
      'mercury-coder': 16384,
      'mercury-coder-small': 16384,
      'mercury-coder-large': 16384,
    };
    function getMaxTokensForModel(model) {
      return MODEL_MAX_TOKENS[model] || 16384;
    }
    function updateReasoningToggleVisibility(model) {
      const wrap = document.getElementById('reasoning-toggle-wrap');
      wrap.style.display = model === 'mercury-2' ? 'flex' : 'none';
    }

    function applyMaxTokensForModel(model) {
      const max = getMaxTokensForModel(model);
      const input = document.getElementById('max-tokens-input');
      input.max = max;
      document.querySelector('label[for="max-tokens-input"] + input + .setting-description').textContent =
        `Maximum number of tokens in response (1\u2013${max})`;
      // Clamp existing value if it exceeds the new max
      if (parseInt(input.value) > max) input.value = max;
    }

    // Sidebar toggle functionality
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const mainContent = document.getElementById('main-content');
    
    function toggleSidebar() {
      const isOpen = sidebar.classList.contains('open');
      
      if (isOpen) {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('open');
        mainContent.classList.remove('sidebar-open');
      } else {
        sidebar.classList.add('open');
        sidebarOverlay.classList.add('open');
        mainContent.classList.add('sidebar-open');
      }
    }
    
    hamburgerBtn.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', toggleSidebar);
    
    // Sidebar menu actions
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', (e) => {
        // Remove active class from all items
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        // Add active class to clicked item
        e.target.classList.add('active');
        
        const action = e.target.dataset.action;
        switch(action) {
          case 'new-chat':
            // Clear the chat
            document.getElementById('results').innerHTML = '';
            // Clear the input field
            document.getElementById('chat-input').value = '';
            // Start new chat in database
            if (window.electronAPI) {
              window.electronAPI.newChat();
            }
            // Dispatch event to refresh recent chats
            setTimeout(() => {
              document.dispatchEvent(new CustomEvent('refreshRecentChats'));
            }, 100);
            break;
          case 'recents':
            // TODO: Show recent chats
            break;
          case 'settings':
            // Settings functionality moved to bottom button
            break;
        }
        
        // Close sidebar on mobile after selection
        if (window.innerWidth <= 768) {
          toggleSidebar();
        }
      });
    });
    
    // Bottom buttons functionality
    const clearChatBtn = document.getElementById('clear-chat-btn');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModal = document.getElementById('settings-modal');
    const modalClose = document.getElementById('modal-close');
    
    // Clear chat functionality
    clearChatBtn.addEventListener('click', () => {
      // Clear the chat
      document.getElementById('results').innerHTML = '';
      // Clear the input field
      document.getElementById('chat-input').value = '';
      // Start new chat in database
      if (window.electronAPI) {
        window.electronAPI.newChat();
      }
      // Dispatch event to refresh recent chats
      setTimeout(() => {
        document.dispatchEvent(new CustomEvent('refreshRecentChats'));
      }, 100);
    });
    
    // Settings modal functionality
    settingsBtn.addEventListener('click', async () => {
      // Load settings when opening modal
      if (window.electronAPI) {
        try {
          const settings = await window.electronAPI.loadSettings();
          document.getElementById('api-key-input').value = settings.apiKey || '';
          const currentModel = settings.model || 'mercury-2';
          document.getElementById('model-setting').value = currentModel;
          applyMaxTokensForModel(currentModel);
          const modelMax = getMaxTokensForModel(currentModel);
          const savedTokens = settings.maxTokens;
          // Use saved value only if it's a valid custom value below the model max; otherwise use model max
          document.getElementById('max-tokens-input').value = (savedTokens && savedTokens <= modelMax) ? savedTokens : modelMax;
          document.getElementById('theme-setting').value = settings.theme || 'dark';
        } catch (error) {
          console.error('Error loading settings:', error);
        }
      }
      settingsModal.classList.add('open');
    });
    
    async function closeModal() {
      // Save settings when closing modal
      if (window.electronAPI) {
        try {
          const settings = {
            apiKey: document.getElementById('api-key-input').value,
            model: document.getElementById('model-setting').value,
            maxTokens: parseInt(document.getElementById('max-tokens-input').value) || getMaxTokensForModel(document.getElementById('model-setting').value),
            theme: document.getElementById('theme-setting').value
          };
          await window.electronAPI.saveSettings(settings);
          
          // Update the model dropdown in the main UI
          document.getElementById('model-select').value = settings.model;
        } catch (error) {
          console.error('Error saving settings:', error);
        }
      }
      settingsModal.classList.remove('open');
    }
    
    // Add event listener for model setting changes in the modal
    document.getElementById('model-setting').addEventListener('change', async function(e) {
      const selectedModel = e.target.value;

      // Update max tokens and reasoning toggle for the newly selected model
      applyMaxTokensForModel(selectedModel);
      document.getElementById('max-tokens-input').value = getMaxTokensForModel(selectedModel);
      updateReasoningToggleVisibility(selectedModel);

      // Update the main dropdown immediately
      document.getElementById('model-select').value = selectedModel;
      
      if (window.electronAPI) {
        try {
          // Load current settings and update model
          const currentSettings = await window.electronAPI.loadSettings() || {};
          currentSettings.model = selectedModel;
          await window.electronAPI.saveSettings(currentSettings);
        } catch (error) {
          console.error('Error saving model preference from settings:', error);
        }
      }
    });
    
    modalClose.addEventListener('click', closeModal);
    
    // Close modal when clicking outside
    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        closeModal();
      }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && settingsModal.classList.contains('open')) {
        closeModal();
      }
    });
    
    // Load settings on page startup and set up auto-save
    async function loadInitialSettings() {
      const modelSelect = document.getElementById('model-select');
      
      if (window.electronAPI) {
        try {
          const settings = await window.electronAPI.loadSettings();
          // Set the saved model or default to 'mercury'
          const savedModel = settings?.model || 'mercury-2';
          modelSelect.value = savedModel;
          updateReasoningToggleVisibility(savedModel);

          // Show API key prompt if no key is configured
          if (!settings?.apiKey || !settings.apiKey.trim()) {
            document.getElementById('api-key-modal').classList.add('open');
            setTimeout(() => document.getElementById('api-key-prompt-input').focus(), 300);
          }
        } catch (error) {
          console.error('Error loading initial settings:', error);
          // Default to 'mercury' on error
          modelSelect.value = 'mercury-2';
          document.getElementById('api-key-modal').classList.add('open');
        }
      } else {
        // Default to 'mercury' if no electronAPI
        modelSelect.value = 'mercury-2';
      }
      
      // Add event listener to auto-save when dropdown changes
      modelSelect.addEventListener('change', async function(e) {
        const selectedModel = e.target.value;

        updateReasoningToggleVisibility(selectedModel);

        // Update the settings modal dropdown immediately
        document.getElementById('model-setting').value = selectedModel;
        
        if (window.electronAPI) {
          try {
            // Load current settings and update model
            const currentSettings = await window.electronAPI.loadSettings() || {};
            currentSettings.model = selectedModel;
            await window.electronAPI.saveSettings(currentSettings);
          } catch (error) {
            console.error('Error saving model preference:', error);
          }
        }
      });
    }
    
    // API key prompt modal handlers
    document.getElementById('api-key-prompt-save').addEventListener('click', async () => {
      const apiKey = document.getElementById('api-key-prompt-input').value.trim();
      if (!apiKey) return;

      if (window.electronAPI) {
        const currentSettings = await window.electronAPI.loadSettings() || {};
        currentSettings.apiKey = apiKey;
        await window.electronAPI.saveSettings(currentSettings);
      }

      document.getElementById('api-key-modal').classList.remove('open');
      // Keep the settings modal input in sync
      document.getElementById('api-key-input').value = apiKey;
    });

    document.getElementById('api-key-prompt-skip').addEventListener('click', () => {
      document.getElementById('api-key-modal').classList.remove('open');
    });

    document.getElementById('api-key-prompt-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('api-key-prompt-save').click();
      if (e.key === 'Escape') document.getElementById('api-key-modal').classList.remove('open');
    });

    // Load settings when page loads
    loadInitialSettings();

    // Display app version in sidebar
    if (window.electronAPI) {
      window.electronAPI.getVersion().then(v => {
        document.getElementById('sidebar-version').textContent = `v${v}`;
      }).catch(() => {});
    }
    
    // Theme management functions
    function applyTheme(theme) {
      const body = document.body;
      
      // Remove existing theme classes
      body.classList.remove('light-theme');
      
      if (theme === 'light') {
        body.classList.add('light-theme');
      } else if (theme === 'auto') {
        // Check system preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (!prefersDark) {
          body.classList.add('light-theme');
        }
      }
      // 'dark' theme is the default, no class needed
    }
    
    // Auto-save theme changes
    async function saveThemeChange(newTheme) {
      if (window.electronAPI) {
        try {
          const currentSettings = await window.electronAPI.loadSettings() || {};
          currentSettings.theme = newTheme;
          await window.electronAPI.saveSettings(currentSettings);
        } catch (error) {
          console.error('Error saving theme preference:', error);
        }
      }
    }
    
    // Add event listener for theme setting changes
    document.getElementById('theme-setting').addEventListener('change', async function(e) {
      const selectedTheme = e.target.value;
      
      // Apply theme immediately
      applyTheme(selectedTheme);
      
      // Save the theme preference
      await saveThemeChange(selectedTheme);
    });
    
    // Load and apply initial theme
    async function loadInitialTheme() {
      if (window.electronAPI) {
        try {
          const settings = await window.electronAPI.loadSettings();
          const savedTheme = settings?.theme || 'dark';
          applyTheme(savedTheme);
        } catch (error) {
          console.error('Error loading initial theme:', error);
          // Default to dark theme on error
          applyTheme('dark');
        }
      } else {
        // Default to dark theme if no electronAPI
        applyTheme('dark');
      }
    }
    
    // Listen for system theme changes when in auto mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', async (e) => {
      if (window.electronAPI) {
        try {
          const settings = await window.electronAPI.loadSettings();
          if (settings?.theme === 'auto') {
            applyTheme('auto');
          }
        } catch (error) {
          console.error('Error checking theme setting on system change:', error);
        }
      }
    });
    
    // Load theme when page loads
    loadInitialTheme();
  </script>
</body>
</html>
